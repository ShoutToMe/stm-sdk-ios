<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Shout to Me iOS SDK</title>
    <meta name="description" content="The Shout to Me iOS SDK Documentation provides information, reference, and examples of how to incorporate Shout to Me platform functionality into your iOS app.
">

    <link rel="stylesheet" href="/stm-sdk-ios/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/stm-sdk-ios/notifications.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/stm-sdk-ios/">Shout to Me iOS SDK</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

  <div style="width:100%">
    <div style="float:left;width:170px;margin-top:50px;margin-left: -170px;">
      <div>iOS SDK</div>
      <ul style="margin-left:10px;list-style: none">
        <li><a href="/stm-sdk-ios/">Home</a></li>
        <li><a href="getting-started">Getting Started</a>
          <ul>
            <li><a href="setup">Setup</a></li>
            <li><a href="sample-app">Sample App</a></li>
          </ul>
        </li>
        <li><a href="user">User</a></li>
        <li><a href="create-shout">Creating a Shout</a></li>
        <li><a href="notifications">Messages and Notifications</a></li>

      </ul>
    </div>
    <div style="width:100%;">
      <h1 id="messages-and-notifications">Messages and Notifications</h1>

<p>The Shout to Me platform allows you to enable your app to receive communications sent from Shout to Me’s Broadcaster
Application.  Messages and notifications are two separate concepts in the Shout to Me system.  A <strong>Message</strong> is text,
audio or video content that is sent to mobile users to convey a communication.  A <strong>Notification</strong> is the delivery
mechanism used to transport a Message.</p>

<h2 id="messages">Messages</h2>
<p>The SDK provides a class that can be used to retrieve messages for the current user, or check if they have
unread messages.</p>

<p>```objc
// Request all of the messages for the current user.
- (void)requestForMessagesWithDelegate:(id<messagesdelegate>)delegate;</messagesdelegate></p>

<p>// Request the count of unread messages for the current user.
- (void)requestForUnreadMessageCountWithDelegate:(id<messagesdelegate>)delegate;</messagesdelegate></p>

<p>// Request a specific message by ID
- (void)requestForMessage:(NSString *)messageId completionHandler:(void (^)(STMMessage *message,
                                                                            NSError *error))completionHandler;
```</p>

<h3 id="retrieving-messages">Retrieving messages</h3>

<p>Follow these steps to retrieve messages:</p>

<h4 id="import-stmh-to-the-header-of-your-view-controller">Import “STM.h” to the header of your view controller</h4>

<p>```objc
//ViewController.h</p>

<h1 id="import-stmh">import <stm.h></stm.h></h1>
<p>```</p>

<h4 id="implement-the-messagesdelegate">Implement the MessagesDelegate</h4>

<p>```objc
//ViewController.h</p>

<p>@interface ViewController : UIViewController<messagesdelegate></messagesdelegate></p>

<p>@end
```</p>

<h4 id="request-messages-in-your-viewcontroller">Request messages in your ViewController</h4>

<p>```objc
//ViewController.m</p>

<ul>
  <li>(void)viewDidLoad {
  [super viewDidLoad];
  [[STM messages] requestForMessagesWithDelegate:self];
}
```</li>
</ul>

<h4 id="implement-the-messagesresults-method-of--messagesdelegate">Implement the MessagesResults method of  MessagesDelegate</h4>

<p>```objc
//ViewController.m</p>

<h1 id="pragma-mark---messages-delegates">pragma mark - Messages Delegates</h1>
<ul>
  <li>(void)MessagesResults:(NSArray *)arrayMessages
{
  // Do something with arrayMessages, load them into a table view data source, etc.
}
```</li>
</ul>

<h3 id="get-unread-message-count">Get Unread Message Count</h3>

<p>Follow these steps to get the unread message count:</p>

<h4 id="import-stmh-to-the-header-of-your-view-controller-1">Import “STM.h” to the header of your view controller</h4>

<p>```objc
//ViewController.h</p>

<h1 id="import-stmh-1">import <stm.h></stm.h></h1>
<p>```</p>

<h4 id="implement-the-messagesdelegate-1">Implement the MessagesDelegate</h4>
<p>```objc</p>

<p>//ViewController.h</p>

<p>@interface ViewController : UIViewController<messagesdelegate></messagesdelegate></p>

<p>@end
```</p>

<h4 id="request-unread-message-count-in-your-viewcontroller">Request unread message count in your ViewController</h4>

<p>```objc
//ViewController.m</p>

<ul>
  <li>(void)viewDidLoad {
  [super viewDidLoad];
  [[STM messages] requestForUnreadMessageCountWithDelegate:self];
}
```</li>
</ul>

<h4 id="implement-the-unreadmessageresults-method-of-messagesdelegate">Implement the UnreadMessageResults method of MessagesDelegate</h4>

<p>```objc
//ViewController.m</p>

<h1 id="pragma-mark---messages-delegates-1">pragma mark - Messages Delegates</h1>
<ul>
  <li>(void)UnreadMessageResults:(NSNumber *)count {
  // Do something with count like setting a label’s text, etc.
}
```</li>
</ul>

<h2 id="notifications">Notifications</h2>
<p>The Shout to Me SDK supports receiving push notifications from the Shout to Me platform.  The SDK will only handle
notifications sent from the Shout to Me system.  There are a number of components used in sending and receiving notifications,
and consequently, there are a number of items that need to be wired up. The following high level steps occur when a message
is sent from the Shout to Me system:</p>

<ol>
  <li>A message is sent from the Shout to Me Broadcaster Application</li>
  <li>The message is delivered to the client app as an Apple Push Notification Service (APNs) notification</li>
  <li>The client app passes the notification data received from iOS to the Shout to Me SDK</li>
  <li>The Shout to Me SDK processes the notification data and calls a listener if applicable</li>
  <li>A listener in the client app receives the call from the Shout to Me SDK and can take further action using the data</li>
</ol>

<h3 id="enable-project-capabilities">Enable Project Capabilities</h3>
<p>In your project Capabilities tab in Xcode, enable Push Notifications and Background Modes. Under Background Modes select Location Updates.
Location Updates allows the Shout to Me SDK to monitor the user’s location in the background in order to delivery geo-targeted messages.
The Shout to Me SDK uses Apple’s <a href="https://developer.apple.com/documentation/corelocation/getting_the_user_s_location/using_the_significant_change_location_service">Significant Change Location Service</a>
to minimize power consumption.</p>

<p><img src="images/push-notifications.png" alt="Push Notifications in Xcode" /></p>

<p><img src="images/background-modes.png" alt="Background Modes in Xcode" /></p>

<h3 id="apns-certificate">APNs Certificate</h3>
<p>Pushing notifications requires the creation of an APNs certificate that is subsequently included in the app’s provisioning profile.
Shout to Me will also use this certificate to register with its push notification platform.  Once these two items are done,
you will receive a push notification App ID that will be used to register for push notifications.
Contact Shout to Me to complete this process.
For more information, visit the <a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1">Apple Notification Programming Guide</a>.</p>

<h3 id="enablingdisabling-notifications">Enabling/Disabling Notifications</h3>
<p>To enable or disable notifications at the user’s request, add code that subscribes/unsubscribes to/from the specified channel.  The following code sample shows how to accomplish this.</p>

<h4 id="subscribe-to-a-channel">Subscribe to a channel</h4>

<p><code>objc
[[STM subscriptions] requestForSubscribe:(NSString *)channelId completionHandler:^(STMSubscription *subscription, NSError *error) {
    if (error) {    
         NSLog(@"Error occurred subscribing to channel");
    } else {
         NSLog(@"Subscribe succeeded");
    }
}];
</code></p>

<p><code>objc
#### Unsubscribe from a channel
[[STM subscriptions] requestForUnSubscribe:(NSString *)channelId completionHandler:^(Boolean *successful, NSError *error) {
    if (error) {    
         NSLog(@"Error occurred unsubscribing from channel");
    } else {
         NSLog(@"Unsubscribe succeeded");
    }
}];
</code></p>

<h3 id="notification-events">Notification Events</h3>

<p>To integrate with the Shout to Me notification system, follow these instructions:</p>

<h4 id="implement-the-stmdelegate-in-appdelegateh">Implement the <code>STMDelegate</code> in <code>AppDelegate.h</code></h4>

<p>```objc
#import <stm.h></stm.h></p>

<p>@interface AppDelegate : UIResponder &lt;UIApplicationDelegate, STMDelegate&gt;
@property (strong, nonatomic) UIWindow *window;
@end
```</p>

<h4 id="include-the-following-in-your-didfinishlaunchingwithoptions-callback">Include the following in your <code>didFinishLaunchingWithOptions</code> callback</h4>
<p>First, call the <code>setupPushNotificationsWithAppId:(NSString *)pushNotificationAppId</code>
method with your App ID (see APNs Certificate above) to register for notifications from the Shout to Me system.
Then register to receive remote notifications from iOS.  Your specific registration may vary depending
on other types of notifications you receive, however, a simple registration is shown below.</p>

<p>(Note: The following iOS notification code is for iOS 10 and above.  You may need additional code to support iOS versions below iOS 10.)</p>

<p>```objc
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {</p>

<pre><code>// ...

[STM setupPushNotificationsWithAppId:@"YOUR_APP_ID"];

// Register for remote iOS notifications
UNAuthorizationOptions options = UNAuthorizationOptionAlert + UNAuthorizationOptionSound + UNAuthorizationOptionBadge;
UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
center.delegate = self;
[center requestAuthorizationWithOptions:(options) completionHandler:^(BOOL granted, NSError * _Nullable error) {
    if (!granted)
    {
        NSLog(@"One or more notification permissions are not granted.");
    }
    else if (!error)
    {
        [[UIApplication sharedApplication] registerForRemoteNotifications];
        NSLog(@"Push registration success.");
    }
    else
    {
        NSLog(@"Push registration FAILED");
        NSLog(@"ERROR: %@", error);
    }
}];

// ... } ```
</code></pre>

<h4 id="implement-the-following-ios-lifecycle-events-to-pass-required-data-to-the-shout-to-me-sdk">Implement the following iOS lifecycle events to pass required data to the Shout to Me SDK.</h4>

<p>```objc
- (void)application:(UIApplication<em>)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData</em>)deviceToken{
    [STM didRegisterForRemoteNotificationsWithDeviceToken: deviceToken];
}</p>

<ul>
  <li>
    <p>(void)application:(UIApplication<em>)application didFailToRegisterForRemoteNotificationsWithError:(NSError</em>)error{
  // There is no data to pass to the Shout to Me SDK, however, this method is helpful to troubleshoot push notification registration failures.
  NSLog(@”Failed to register with error : %@”, error);
}</p>
  </li>
  <li>
    <p>(void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {
  [STM didReceiveRemoteNotification:userInfo ForApplication:application fetchCompletionHandler:completionHandler];
}
```</p>
  </li>
</ul>

<h4 id="implement-the-stmnotificationsreceived-method-to-listen-for-shout-to-me-notifications">Implement the <code>STMNotificationsReceived</code> method to listen for Shout to Me notifications.</h4>

<p>```objc
-(void)STMNotificationsReceived:(NSSet *)notification {</p>

<pre><code>// Each set can include 1 or more notifications.  Each notification is represented as a dictionary with the following fields:
// @"body":             Typically the body of a UI notification
// @"category":         @"MESSAGE_CATEGORY" for message notifications
// @"channel_id":       Your channel ID - necessary for apps containing multiple channels
// @"conversation_id":  The Shout to Me conversation ID which can be used to retrieve more detailed data from the Shout to Me API
// @"title":            Typically the title of a UI notification
// @"type":             @"conversation message" for notifications directed at a whole channel or @"user message" for messages directed to a specific user
// @"message_id":       The ID of the message stored in the Shout to Me system. } ```
</code></pre>


    </div>
  </div>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Shout to Me iOS SDK</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Shout to Me iOS SDK</li>
          <li><a href="mailto:support@shoutto.me">support@shoutto.me</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ShoutToMe">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">ShoutToMe</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/shout_to_me">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">shout_to_me</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">The Shout to Me iOS SDK Documentation provides information, reference, and examples of how to incorporate Shout to Me platform functionality into your iOS app.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
